---
import type { HTMLAttributes, HTMLTag } from "astro/types";
import { cva } from "class-variance-authority";
import { cn } from "@bejamas/ui/lib/utils";
import { Button } from "../button";

type GroupButtonSize = "xs" | "sm" | "icon-xs" | "icon-sm";

type Props = {
  as?: HTMLTag;
  size?: GroupButtonSize;
  variant?:
    | "default"
    | "secondary"
    | "outline"
    | "ghost"
    | "destructive"
    | "link";
  type?: "button" | "submit" | "reset";
  class?: string;
} & HTMLAttributes<"button">;

const {
  as: rawTag,
  size = "xs",
  variant = "ghost",
  type = "button",
  class: className = "",
  ...rest
} = Astro.props as Props;

const inputGroupButtonVariants = cva(
  "inline-flex shrink-0 items-center justify-center shadow-none",
  {
    variants: {
      size: {
        xs: "rounded-[calc(var(--radius)-3px)] group-data-[size=sm]/input-group:h-6 group-data-[size=sm]/input-group:gap-1 group-data-[size=sm]/input-group:px-1.5 group-data-[size=sm]/input-group:text-xs group-data-[size=sm]/input-group:[&>svg:not([class*='size-'])]:size-3.5 group-data-[size=default]/input-group:h-7 group-data-[size=default]/input-group:gap-1.5 group-data-[size=default]/input-group:px-2 group-data-[size=default]/input-group:text-sm group-data-[size=default]/input-group:[&>svg:not([class*='size-'])]:size-4 group-data-[size=lg]/input-group:h-8 group-data-[size=lg]/input-group:gap-1.5 group-data-[size=lg]/input-group:px-2.5 group-data-[size=lg]/input-group:text-base group-data-[size=lg]/input-group:[&>svg:not([class*='size-'])]:size-4",
        sm: "rounded-[calc(var(--radius)-2px)] group-data-[size=sm]/input-group:h-7 group-data-[size=sm]/input-group:gap-1.5 group-data-[size=sm]/input-group:px-2.5 group-data-[size=sm]/input-group:text-xs group-data-[size=default]/input-group:h-8 group-data-[size=default]/input-group:gap-1.5 group-data-[size=default]/input-group:px-3 group-data-[size=default]/input-group:text-sm group-data-[size=lg]/input-group:h-9 group-data-[size=lg]/input-group:gap-2 group-data-[size=lg]/input-group:px-3.5 group-data-[size=lg]/input-group:text-base",
        "icon-xs":
          "rounded-[calc(var(--radius)-3px)] p-0 has-[>svg]:p-0 group-data-[size=sm]/input-group:size-6 group-data-[size=default]/input-group:size-7 group-data-[size=lg]/input-group:size-8",
        "icon-sm":
          "p-0 has-[>svg]:p-0 group-data-[size=sm]/input-group:size-7 group-data-[size=default]/input-group:size-8 group-data-[size=lg]/input-group:size-9",
      },
    },
    defaultVariants: {
      size: "xs",
    },
  },
);

const Tag = rawTag ?? undefined;
---

{
  Tag ? (
    <Tag
      {...rest}
      data-slot="input-group-button"
      class={cn(inputGroupButtonVariants({ size }), className)}
    >
      <slot />
    </Tag>
  ) : (
    <Button
      type={type}
      variant={variant}
      data-slot="input-group-button"
      class={cn(inputGroupButtonVariants({ size }), className)}
      {...(rest as any)}
    >
      <slot />
    </Button>
  )
}
