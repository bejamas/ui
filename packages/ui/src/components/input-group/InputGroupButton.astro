---
import type { HTMLAttributes, HTMLTag } from "astro/types";
import { cva } from "class-variance-authority";
import { cn } from "@bejamas/ui/lib/utils";
import { Button } from "../button";

type GroupButtonSize = "xs" | "sm" | "icon-xs" | "icon-sm";

type Props = {
  as?: HTMLTag;
  size?: GroupButtonSize;
  variant?:
    | "default"
    | "secondary"
    | "outline"
    | "ghost"
    | "destructive"
    | "link";
  type?: "button" | "submit" | "reset";
  class?: string;
} & HTMLAttributes<"button">;

const {
  as: rawTag,
  size = "xs",
  variant = "ghost",
  type = "button",
  class: className = "",
  ...rest
} = Astro.props as Props;

const inputGroupButtonVariants = cva(
  "gap-2 text-sm shadow-none flex items-center",
  {
    variants: {
      size: {
        xs: "h-6 gap-1 rounded-[calc(var(--radius)-3px)] px-1.5 [&>svg:not([class*='size-'])]:size-3.5",
        sm: "",
        "icon-xs":
          "size-6 rounded-[calc(var(--radius)-3px)] p-0 has-[>svg]:p-0",
        "icon-sm": "size-8 p-0 has-[>svg]:p-0",
      },
    },
    defaultVariants: {
      size: "xs",
    },
  },
);

const Tag = rawTag ?? undefined;
---

{
  Tag ? (
    <Tag
      {...rest}
      data-slot="input-group-button"
      class={cn(inputGroupButtonVariants({ size }), className)}
    >
      <slot />
    </Tag>
  ) : (
    <Button
      type={type}
      variant={variant}
      data-size={size}
      data-slot="input-group-button"
      class={cn(inputGroupButtonVariants({ size }), className)}
      {...(rest as any)}
    >
      <slot />
    </Button>
  )
}
