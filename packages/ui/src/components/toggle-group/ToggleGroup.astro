---
/**
 * @component ToggleGroup
 * @title Toggle Group
 * @description A set of two-state buttons that can be toggled on or off. Supports single or multiple selection.
 *
 * @preview
 *
 * <ToggleGroup defaultValue="center" variant="outline">
 *   <ToggleGroupItem value="left" aria-label="Align left">
 *     <AlignLeftIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="center" aria-label="Align center">
 *     <AlignCenterIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="right" aria-label="Align right">
 *     <AlignRightIcon />
 *   </ToggleGroupItem>
 * </ToggleGroup>
 *
 * @usage
 *
 * ```astro nocollapse
 * ---
 * import { ToggleGroup, ToggleGroupItem } from '@bejamas/ui/components/toggle-group';
 * import { BoldIcon, ItalicIcon, UnderlineIcon } from '@lucide/astro';
 * ---
 *
 * <ToggleGroup defaultValue="bold" variant="outline">
 *   <ToggleGroupItem value="bold" aria-label="Toggle bold">
 *     <BoldIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="italic" aria-label="Toggle italic">
 *     <ItalicIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="underline" aria-label="Toggle underline">
 *     <UnderlineIcon />
 *   </ToggleGroupItem>
 * </ToggleGroup>
 * ```
 *
 * @api
 *
 * ### Events
 *
 * | Event | Detail | Description |
 * |-------|--------|-------------|
 * | `toggle-group:change` | `{ value: string[] }` | Fired when the selection changes |
 *
 * ### Programmatic Control
 *
 * ```js nocollapse
 * // Set selected values programmatically
 * element.dispatchEvent(new CustomEvent('toggle-group:set', {
 *   detail: { value: ['bold', 'italic'] }
 * }));
 * ```
 *
 * ### Data Attributes
 *
 * | Attribute | Element | Description |
 * |-----------|---------|-------------|
 * | `data-state` | toggle-group-item | Current state: `on` or `off` |
 * | `data-disabled` | toggle-group | Present when group is disabled |
 * | `data-orientation` | toggle-group | Orientation: `horizontal` or `vertical` |
 * | `data-variant` | toggle-group | Visual variant: `default` or `outline` |
 * | `data-size` | toggle-group | Size: `sm`, `default`, or `lg` |
 *
 * @examples
 *
 * ### Multiple Selection
 *
 * <ToggleGroup multiple defaultValue={["bold", "italic"]} variant="outline">
 *   <ToggleGroupItem value="bold" aria-label="Toggle bold">
 *     <BoldIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="italic" aria-label="Toggle italic">
 *     <ItalicIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="underline" aria-label="Toggle underline">
 *     <UnderlineIcon />
 *   </ToggleGroupItem>
 * </ToggleGroup>
 *
 * ### Outline Variant
 *
 * <ToggleGroup variant="outline" defaultValue="center">
 *   <ToggleGroupItem value="left" aria-label="Align left">
 *     <AlignLeftIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="center" aria-label="Align center">
 *     <AlignCenterIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="right" aria-label="Align right">
 *     <AlignRightIcon />
 *   </ToggleGroupItem>
 * </ToggleGroup>
 *
 * ### Sizes
 *
 * <div class="flex flex-col gap-4">
 *   <ToggleGroup size="sm" variant="outline" defaultValue="center">
 *     <ToggleGroupItem value="left" aria-label="Align left">
 *       <AlignLeftIcon />
 *     </ToggleGroupItem>
 *     <ToggleGroupItem value="center" aria-label="Align center">
 *       <AlignCenterIcon />
 *     </ToggleGroupItem>
 *     <ToggleGroupItem value="right" aria-label="Align right">
 *       <AlignRightIcon />
 *     </ToggleGroupItem>
 *   </ToggleGroup>
 *   <ToggleGroup size="default" variant="outline" defaultValue="center">
 *     <ToggleGroupItem value="left" aria-label="Align left">
 *       <AlignLeftIcon />
 *     </ToggleGroupItem>
 *     <ToggleGroupItem value="center" aria-label="Align center">
 *       <AlignCenterIcon />
 *     </ToggleGroupItem>
 *     <ToggleGroupItem value="right" aria-label="Align right">
 *       <AlignRightIcon />
 *     </ToggleGroupItem>
 *   </ToggleGroup>
 *   <ToggleGroup size="lg" variant="outline" defaultValue="center">
 *     <ToggleGroupItem value="left" aria-label="Align left">
 *       <AlignLeftIcon />
 *     </ToggleGroupItem>
 *     <ToggleGroupItem value="center" aria-label="Align center">
 *       <AlignCenterIcon />
 *     </ToggleGroupItem>
 *     <ToggleGroupItem value="right" aria-label="Align right">
 *       <AlignRightIcon />
 *     </ToggleGroupItem>
 *   </ToggleGroup>
 * </div>
 *
 * ### Vertical Orientation
 *
 * <ToggleGroup orientation="vertical" variant="outline" defaultValue="middle">
 *   <ToggleGroupItem value="top" aria-label="Align top">
 *     <AlignVerticalJustifyStartIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="middle" aria-label="Align middle">
 *     <AlignVerticalJustifyCenterIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="bottom" aria-label="Align bottom">
 *     <AlignVerticalJustifyEndIcon />
 *   </ToggleGroupItem>
 * </ToggleGroup>
 *
 * ### Disabled
 *
 * <ToggleGroup disabled variant="outline" defaultValue="center">
 *   <ToggleGroupItem value="left" aria-label="Align left">
 *     <AlignLeftIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="center" aria-label="Align center">
 *     <AlignCenterIcon />
 *   </ToggleGroupItem>
 *   <ToggleGroupItem value="right" aria-label="Align right">
 *     <AlignRightIcon />
 *   </ToggleGroupItem>
 * </ToggleGroup>
 *
 */

import type { HTMLAttributes } from "astro/types";
import { cn } from "@bejamas/ui/lib/utils";

type Props = {
  variant?: "default" | "outline";
  size?: "default" | "sm" | "lg";
  defaultValue?: string | string[];
  multiple?: boolean;
  orientation?: "horizontal" | "vertical";
  disabled?: boolean;
  class?: string;
} & Omit<HTMLAttributes<"div">, "class">;

const {
  variant = "default",
  size = "default",
  defaultValue,
  multiple = false,
  orientation = "horizontal",
  disabled = false,
  class: className = "",
  ...rest
} = Astro.props as Props;
---

<div
  data-slot="toggle-group"
  data-variant={variant}
  data-size={size}
  data-orientation={orientation}
  data-disabled={disabled ? "true" : undefined}
  data-default-value={Array.isArray(defaultValue) ? defaultValue.join(",") : defaultValue}
  data-multiple={multiple ? "true" : undefined}
  class={cn(
    "group/toggle-group flex w-fit items-center rounded-lg",
    orientation === "vertical" && "flex-col",
    className
  )}
  {...rest}
>
  <slot />
</div>

<script>
  import { createToggleGroup } from "@data-slot/toggle-group";
  document.querySelectorAll('[data-slot="toggle-group"]').forEach((el) => {
    const defaultValue = el.dataset.defaultValue;
    createToggleGroup(el, {
      multiple: el.dataset.multiple === "true",
      orientation: el.dataset.orientation as "horizontal" | "vertical",
      disabled: el.dataset.disabled === "true",
      defaultValue: defaultValue?.includes(",") ? defaultValue.split(",") : defaultValue,
    });
  });
</script>
