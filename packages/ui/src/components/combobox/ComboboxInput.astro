---
import type { HTMLAttributes } from "astro/types";
import { cn } from "@bejamas/ui/lib/utils";
import {
  InputGroup,
  InputGroupInput,
  InputGroupAddon,
  InputGroupButton,
} from "../input-group";
import ChevronDownIcon from "@lucide/astro/icons/chevron-down";
import XIcon from "@lucide/astro/icons/x";

type Props = {
  class?: string;
  size?: "sm" | "default" | "lg";
  placeholder?: string;
  disabled?: boolean;
  showTrigger?: boolean;
  showClear?: boolean;
} & Omit<HTMLAttributes<"input">, "size">;

const {
  class: className = "",
  size = "default",
  placeholder,
  disabled = false,
  showTrigger = true,
  showClear = false,
  ...rest
} = Astro.props as Props;
---

<InputGroup size={size} class={cn("w-auto", className)}>
  <InputGroupInput
    data-slot="combobox-input"
    placeholder={placeholder}
    disabled={disabled}
    autocomplete="off"
    {...rest}
  />
  {
    (showTrigger || showClear) && (
      <InputGroupAddon align="inline-end">
        {showClear && (
          <InputGroupButton
            data-slot="combobox-clear"
            type="button"
            size="icon-xs"
            class="hidden [[data-value]_&]:inline-flex"
            aria-label="Clear selection"
          >
            <XIcon class="size-3.5 group-data-[size=sm]/input-group:size-3" />
          </InputGroupButton>
        )}
        {showTrigger && (
          <InputGroupButton
            data-slot="combobox-trigger"
            type="button"
            size="icon-xs"
            tabindex={-1}
            disabled={disabled}
            class={cn(
              "text-muted-foreground",
              showClear && "[[data-value]_&]:hidden",
            )}
            aria-label="Toggle menu"
          >
            <ChevronDownIcon
              data-slot="combobox-icon"
              class="size-4 group-data-[size=sm]/input-group:size-3.5"
            />
          </InputGroupButton>
        )}
      </InputGroupAddon>
    )
  }
</InputGroup>
