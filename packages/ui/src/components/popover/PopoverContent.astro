---
import type { HTMLAttributes } from "astro/types";
import { cn } from "@bejamas/ui/lib/utils";

type Props = {
  align?: "start" | "center" | "end";
  sideOffset?: number;
  class?: string;
} & HTMLAttributes<"div">;

const {
  align = "center",
  sideOffset = 4,
  class: className = "",
  ...rest
} = Astro.props as Props;

const alignClasses = {
  start: "left-0",
  center: "left-1/2 -translate-x-1/2",
  end: "right-0",
};

---

<!-- Outer: visibility + group + positioning -->
<div
  {...rest}
  data-slot="popover-content"
  data-align={align}
  style={`--side-offset: ${sideOffset}px`}
  class={cn(
    "group/popover-content",
    "absolute top-full mt-[var(--side-offset)] z-50",
    alignClasses[align],
    "hidden data-[state=open]:block [transition:display_150ms_allow-discrete]",
    "[--origin-y:top] data-[side=top]:[--origin-y:bottom]",
    "data-[align=start]:[--origin-x:left] data-[align=center]:[--origin-x:center] data-[align=end]:[--origin-x:right]",
    className,
  )}
>
  <!-- Inner: visual styling + animations -->
  <div
    class={cn(
      "bg-popover text-popover-foreground ring-foreground/10 ring-1",
      "flex flex-col gap-2.5 rounded-lg p-4 text-sm shadow-md",
      "w-72 outline-hidden",
      "group-data-[state=open]/popover-content:animate-in group-data-[state=closed]/popover-content:animate-out",
      "group-data-[state=closed]/popover-content:fade-out-0 group-data-[state=open]/popover-content:fade-in-0",
      "group-data-[state=closed]/popover-content:zoom-out-95 group-data-[state=open]/popover-content:zoom-in-95",
      "[transform-origin:var(--origin-x)_var(--origin-y)]",
      "[--tw-animation-fill-mode:both]",
    )}
  >
    <slot />
  </div>
</div>
