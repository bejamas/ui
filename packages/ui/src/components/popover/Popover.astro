---
/**
 * @component Popover
 * @title Popover
 * @description A floating panel that appears on trigger click, useful for displaying rich content like forms or additional information.
 *
 * @preview
 * <Popover>
 *   <PopoverTrigger variant="outline">Open popover</PopoverTrigger>
 *   <PopoverContent>
 *     <PopoverHeader>
 *       <PopoverTitle>Dimensions</PopoverTitle>
 *       <PopoverDescription>Set the dimensions for the layer.</PopoverDescription>
 *     </PopoverHeader>
 *     <div class="grid gap-2">
 *       <div class="grid grid-cols-3 items-center gap-4">
 *         <Label>Width</Label>
 *         <Input class="col-span-2 h-8" value="100%" />
 *       </div>
 *       <div class="grid grid-cols-3 items-center gap-4">
 *         <Label>Height</Label>
 *         <Input class="col-span-2 h-8" value="25px" />
 *       </div>
 *     </div>
 *   </PopoverContent>
 * </Popover>
 *
 * @usage
 *
 * ```astro nocollapse
 * ---
 * import { Popover, PopoverTrigger, PopoverContent, PopoverHeader, PopoverTitle, PopoverDescription } from '@bejamas/ui/components/popover';
 * ---
 *
 * <Popover>
 *   <PopoverTrigger variant="outline">Open</PopoverTrigger>
 *   <PopoverContent>
 *     <PopoverHeader>
 *       <PopoverTitle>Title</PopoverTitle>
 *       <PopoverDescription>Description text.</PopoverDescription>
 *     </PopoverHeader>
 *     <p>Popover body content.</p>
 *   </PopoverContent>
 * </Popover>
 * ```
 *
 * @api
 *
 * ### Events
 *
 * The popover emits custom events that you can listen to:
 *
 * | Event | Detail | Description |
 * |-------|--------|-------------|
 * | `popover:change` | `{ open: boolean }` | Fired when the popover opens or closes |
 *
 * ```astro nocollapse
 * <Popover id="my-popover">
 *   <PopoverTrigger variant="outline">Open</PopoverTrigger>
 *   <PopoverContent>
 *     <p>Content</p>
 *   </PopoverContent>
 * </Popover>
 *
 * <script>
 *   const popover = document.getElementById('my-popover');
 *
 *   popover.addEventListener('popover:change', (e) => {
 *     console.log('Is open:', e.detail.open);
 *   });
 * </script>
 * ```
 *
 * ### Programmatic Control
 *
 * You can control the popover programmatically by dispatching a `popover:set` event:
 *
 * ```js nocollapse
 * const popover = document.getElementById('my-popover');
 *
 * // Open the popover
 * popover.dispatchEvent(new CustomEvent('popover:set', {
 *   detail: { open: true }
 * }));
 *
 * // Close the popover
 * popover.dispatchEvent(new CustomEvent('popover:set', {
 *   detail: { open: false }
 * }));
 * ```
 *
 * ### Data Attributes
 *
 * The popover sets these data attributes that you can use for styling or querying state:
 *
 * | Attribute | Element | Description |
 * |-----------|---------|-------------|
 * | `data-state` | popover, popover-content | Current state (`open` or `closed`) |
 * | `data-side` | popover, popover-content | Position relative to trigger (`top`, `bottom`, `left`, `right`) |
 * | `data-align` | popover, popover-content | Alignment (`start`, `center`, or `end`) |
 *
 * @examples
 *
 * ### Basic
 *
 * <Popover>
 *   <PopoverTrigger variant="outline">Open popover</PopoverTrigger>
 *   <PopoverContent>
 *     <PopoverHeader>
 *       <PopoverTitle>Popover Title</PopoverTitle>
 *       <PopoverDescription>This is a simple popover.</PopoverDescription>
 *     </PopoverHeader>
 *   </PopoverContent>
 * </Popover>
 *
 * ### Side Variants
 *
 * <div class="grid grid-cols-2 gap-4">
 *   <Popover side="left">
 *     <PopoverTrigger variant="outline">Left</PopoverTrigger>
 *     <PopoverContent>
 *       <p>Popover on the left</p>
 *     </PopoverContent>
 *   </Popover>
 *   <Popover side="top">
 *     <PopoverTrigger variant="outline">Top</PopoverTrigger>
 *     <PopoverContent>
 *       <p>Popover on top</p>
 *     </PopoverContent>
 *   </Popover>
 *   <Popover side="bottom">
 *     <PopoverTrigger variant="outline">Bottom</PopoverTrigger>
 *     <PopoverContent>
 *       <p>Popover on bottom</p>
 *     </PopoverContent>
 *   </Popover>
 *   <Popover side="right">
 *     <PopoverTrigger variant="outline">Right</PopoverTrigger>
 *     <PopoverContent>
 *       <p>Popover on the right</p>
 *     </PopoverContent>
 *   </Popover>
 * </div>
 *
 * ### Alignment Variants
 *
 * <div class="flex gap-8">
 *   <Popover side="bottom" align="start">
 *     <PopoverTrigger variant="outline">Start</PopoverTrigger>
 *     <PopoverContent>
 *       <p>Start-aligned content</p>
 *     </PopoverContent>
 *   </Popover>
 *   <Popover side="bottom" align="center">
 *     <PopoverTrigger variant="outline">Center</PopoverTrigger>
 *     <PopoverContent>
 *       <p>Center-aligned content</p>
 *     </PopoverContent>
 *   </Popover>
 *   <Popover side="bottom" align="end">
 *     <PopoverTrigger variant="outline">End</PopoverTrigger>
 *     <PopoverContent>
 *       <p>End-aligned content</p>
 *     </PopoverContent>
 *   </Popover>
 * </div>
 *
 * ### With Form
 *
 * <Popover>
 *   <PopoverTrigger variant="outline">Open form</PopoverTrigger>
 *   <PopoverContent>
 *     <PopoverHeader>
 *       <PopoverTitle>Dimensions</PopoverTitle>
 *       <PopoverDescription>Set the dimensions for the layer.</PopoverDescription>
 *     </PopoverHeader>
 *     <div class="grid gap-2">
 *       <div class="grid grid-cols-3 items-center gap-4">
 *         <Label>Width</Label>
 *         <Input class="col-span-2 h-8" value="100%" />
 *       </div>
 *       <div class="grid grid-cols-3 items-center gap-4">
 *         <Label>Height</Label>
 *         <Input class="col-span-2 h-8" value="25px" />
 *       </div>
 *     </div>
 *   </PopoverContent>
 * </Popover>
 */

import type { HTMLAttributes } from "astro/types";
import { cn } from "@bejamas/ui/lib/utils";

type Props = {
  side?: "top" | "bottom" | "left" | "right";
  align?: "start" | "center" | "end";
  class?: string;
} & HTMLAttributes<"div">;

const {
  side = "bottom",
  align = "center",
  class: className = "",
  ...rest
} = Astro.props as Props;
---

<div
  {...rest}
  data-slot="popover"
  data-side={side}
  data-align={align}
  class={cn("inline-block", className)}
>
  <slot />
</div>

<script>
  import { createPopover } from "@data-slot/popover";
  document
    .querySelectorAll('[data-slot="popover"]')
    .forEach((el) => createPopover(el));
</script>
