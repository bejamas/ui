---
import { cva } from "class-variance-authority";
import { cn } from "@bejamas/ui/lib/utils";
import type { HTMLAttributes } from "astro/types";

type Props = {
  class?: string;
  /** Radix-like: render wrapper so the child can be the interactive element */
  asChild?: boolean;
} & HTMLAttributes<"button">;

const { class: className = "", asChild = false, type = "button", ...rest } = Astro.props as Props;

const triggerVariants = cva(
  "focus-visible:border-ring w-full focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[aria-expanded=true]>svg]:rotate-180",
);
---

{
  asChild ? (
    <div data-slot="accordion-trigger" data-as-child class={cn(triggerVariants(), className)}>
      <slot />
    </div>
  ) : (
    <button
      {...rest}
      type={type}
      data-slot="accordion-trigger"
      class={cn(triggerVariants(), className)}
    >
      <span class="flex-1">
        <slot />
      </span>
      {
        Astro.slots.has("icon") ? (
          <span class="inline-flex items-center justify-center transition-transform duration-200 group-open/accordion:rotate-180">
            <slot name="icon" />
          </span>
        ) : (
          <svg
            class="size-4 shrink-0 text-muted-foreground translate-y-0.5 transition-transform duration-200 group-open/accordion:rotate-180"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <path d="m6 9 6 6 6-6" />
          </svg>
        )
      }
    </button>
  )
}
