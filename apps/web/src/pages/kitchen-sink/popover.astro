---
import KitchenSinkLayout from "@/components/KitchenSinkLayout.astro";
import KitchenSinkSection from "@/components/KitchenSinkSection.astro";
import EventLog from "@/components/EventLog.astro";
import { Label } from "@bejamas/ui/components/label";
import { Input } from "@bejamas/ui/components/input";
import {
  Select,
  SelectTrigger,
  SelectValue,
  SelectContent,
  SelectItem,
} from "@bejamas/ui/components/select";
import {
  Popover,
  PopoverTrigger,
  PopoverContent,
  PopoverClose,
  PopoverHeader,
  PopoverTitle,
  PopoverDescription,
} from "@bejamas/ui/components/popover";
import { Button } from "@bejamas/ui/components/button";
import {
  Dialog,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
} from "@bejamas/ui/components/dialog";
---

<KitchenSinkLayout>
  <section class="max-w-4xl mx-auto py-20 px-5 space-y-12">
    <h1 class="text-3xl font-bold mb-10">Popover</h1>

    <KitchenSinkSection title="Basic">
      <p class="text-sm text-muted-foreground">
        Simple popover with header, title, and description
      </p>
      <Popover>
        <PopoverTrigger variant="outline">Open popover</PopoverTrigger>
        <PopoverContent>
          <PopoverHeader>
            <PopoverTitle>Popover Title</PopoverTitle>
            <PopoverDescription
              >This is a simple popover with some descriptive text.</PopoverDescription
            >
          </PopoverHeader>
        </PopoverContent>
      </Popover>
    </KitchenSinkSection>

    <KitchenSinkSection title="Side Variants">
      <p class="text-sm text-muted-foreground">
        Use the <code>side</code> prop on <code>Popover</code> to control where content
        opens.
      </p>
      <div class="flex flex-wrap items-center gap-8 py-2">
        <Popover>
          <PopoverTrigger variant="outline">Left</PopoverTrigger>
          <PopoverContent side="left">
            <PopoverHeader>
              <PopoverTitle>Left Side</PopoverTitle>
              <PopoverDescription
                >Appears to the left of the trigger.</PopoverDescription
              >
            </PopoverHeader>
          </PopoverContent>
        </Popover>

        <Popover>
          <PopoverTrigger variant="outline">Top</PopoverTrigger>
          <PopoverContent side="top">
            <PopoverHeader>
              <PopoverTitle>Top Side</PopoverTitle>
              <PopoverDescription>Appears above the trigger.</PopoverDescription
              >
            </PopoverHeader>
          </PopoverContent>
        </Popover>

        <Popover>
          <PopoverTrigger variant="outline">Bottom</PopoverTrigger>
          <PopoverContent side="bottom">
            <PopoverHeader>
              <PopoverTitle>Bottom Side</PopoverTitle>
              <PopoverDescription
                >Appears below the trigger (default).</PopoverDescription
              >
            </PopoverHeader>
          </PopoverContent>
        </Popover>

        <Popover>
          <PopoverTrigger variant="outline">Right</PopoverTrigger>
          <PopoverContent side="right">
            <PopoverHeader>
              <PopoverTitle>Right Side</PopoverTitle>
              <PopoverDescription
                >Appears to the right of the trigger.</PopoverDescription
              >
            </PopoverHeader>
          </PopoverContent>
        </Popover>
      </div>
    </KitchenSinkSection>

    <KitchenSinkSection title="Alignment Variants">
      <p class="text-sm text-muted-foreground">
        Set <code>align</code> on <code>Popover</code> for defaults, then override
        with <code>PopoverContent</code> when needed.
      </p>
      <div class="flex flex-wrap gap-8">
        <Popover>
          <PopoverTrigger variant="outline">Start</PopoverTrigger>
          <PopoverContent side="bottom" align="start">
            <PopoverHeader>
              <PopoverTitle>Start Aligned</PopoverTitle>
              <PopoverDescription>Root alignment is start.</PopoverDescription>
            </PopoverHeader>
          </PopoverContent>
        </Popover>

        <Popover>
          <PopoverTrigger variant="outline">Center</PopoverTrigger>
          <PopoverContent side="bottom" align="center">
            <PopoverHeader>
              <PopoverTitle>Center Aligned</PopoverTitle>
              <PopoverDescription>Root alignment is center.</PopoverDescription>
            </PopoverHeader>
          </PopoverContent>
        </Popover>

        <Popover>
          <PopoverTrigger variant="outline">End</PopoverTrigger>
          <PopoverContent side="bottom" align="end">
            <PopoverHeader>
              <PopoverTitle>End Aligned</PopoverTitle>
              <PopoverDescription>Root alignment is end.</PopoverDescription>
            </PopoverHeader>
          </PopoverContent>
        </Popover>
      </div>

      <Popover>
        <PopoverTrigger variant="outline">
          Root bottom/start, content top/end
        </PopoverTrigger>
        <PopoverContent side="bottom" align="start" class="w-80">
          <PopoverHeader>
            <PopoverTitle>Content Overrides Root</PopoverTitle>
            <PopoverDescription>
              Root sets side=bottom align=start, but content overrides to
              side=top align=end.
            </PopoverDescription>
          </PopoverHeader>
        </PopoverContent>
      </Popover>
    </KitchenSinkSection>

    <KitchenSinkSection title="With Form">
      <p class="text-sm text-muted-foreground">
        Popover containing form fields (Dimensions example)
      </p>
      <Popover>
        <PopoverTrigger variant="outline">Open dimensions</PopoverTrigger>
        <PopoverContent align="start" class="w-80">
          <PopoverHeader>
            <PopoverTitle>Dimensions</PopoverTitle>
            <PopoverDescription
              >Set the dimensions for the layer.</PopoverDescription
            >
          </PopoverHeader>
          <div class="grid gap-3">
            <div class="grid grid-cols-3 items-center gap-2">
              <Label class="text-xs">Width</Label>
              <Input class="col-span-2 h-8" value="100%" />
            </div>
            <div class="grid grid-cols-3 items-center gap-2">
              <Label class="text-xs">Max. width</Label>
              <Input class="col-span-2 h-8" value="300px" />
            </div>
            <div class="grid grid-cols-3 items-center gap-2">
              <Label class="text-xs">Height</Label>
              <Input class="col-span-2 h-8" value="25px" />
            </div>
            <div class="grid grid-cols-3 items-center gap-2">
              <Label class="text-xs">Overflow</Label>
              <Select class="col-span-2">
                <SelectTrigger size="sm">
                  <SelectValue placeholder="Select..." />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="visible">Visible</SelectItem>
                  <SelectItem value="hidden">Hidden</SelectItem>
                  <SelectItem value="scroll">Scroll</SelectItem>
                  <SelectItem value="auto">Auto</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
        </PopoverContent>
      </Popover>
    </KitchenSinkSection>

    <KitchenSinkSection title="With Close Button">
      <p class="text-sm text-muted-foreground">
        Using PopoverClose inside content
      </p>
      <Popover>
        <PopoverTrigger variant="outline">Open with close</PopoverTrigger>
        <PopoverContent align="start">
          <PopoverHeader>
            <PopoverTitle>Closeable</PopoverTitle>
            <PopoverDescription
              >Click the button below to close.</PopoverDescription
            >
          </PopoverHeader>
          <PopoverClose
            class="inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-4 py-2 bg-primary text-primary-foreground shadow-xs hover:bg-primary/90"
          >
            Close popover
          </PopoverClose>
        </PopoverContent>
      </Popover>
    </KitchenSinkSection>

    <KitchenSinkSection title="Event Testing">
      <p class="text-sm text-muted-foreground">
        Console logging popover:change
      </p>
      <Popover id="event-popover">
        <PopoverTrigger variant="outline">Check console</PopoverTrigger>
        <PopoverContent>
          <PopoverHeader>
            <PopoverTitle>Event Test</PopoverTitle>
            <PopoverDescription
              >Open the console to see events.</PopoverDescription
            >
          </PopoverHeader>
        </PopoverContent>
      </Popover>
      <EventLog id="popover-event-output" />
      <script>
        {
          const eventPopover = document.getElementById("event-popover");

          function log(msg: string) {
            (document.getElementById("popover-event-output") as any)?._log(msg);
          }

          eventPopover?.addEventListener("popover:change", (e: Event) => {
            const { open } = (e as CustomEvent).detail;
            log(`popover:change → open: ${open}`);
          });
        }
      </script>
    </KitchenSinkSection>

    <KitchenSinkSection title="In a Dialog">
      <p class="text-sm text-muted-foreground">
        Popover inside a dialog — tests z-index stacking and focus management
      </p>
      <Dialog>
        <DialogTrigger asChild>
          <Button variant="outline">Open Dialog with Popover</Button>
        </DialogTrigger>
        <DialogContent class="sm:max-w-md">
          <DialogHeader>
            <DialogTitle>Dialog with Popover</DialogTitle>
            <DialogDescription>
              Click the button below to open a popover inside this dialog.
            </DialogDescription>
          </DialogHeader>
          <div class="py-4">
            <Popover>
              <PopoverTrigger variant="outline">Open popover</PopoverTrigger>
              <PopoverContent>
                <PopoverHeader>
                  <PopoverTitle>Nested Popover</PopoverTitle>
                  <PopoverDescription>
                    This popover is rendered inside a dialog.
                  </PopoverDescription>
                </PopoverHeader>
              </PopoverContent>
            </Popover>
          </div>
        </DialogContent>
      </Dialog>
    </KitchenSinkSection>

    <KitchenSinkSection title="Programmatic Control">
      <p class="text-sm text-muted-foreground">
        Buttons to open and close programmatically
      </p>
      <div class="flex flex-col gap-4">
        <Popover id="programmatic-popover" class="w-fit">
          <PopoverTrigger variant="outline">Controlled popover</PopoverTrigger>
          <PopoverContent>
            <PopoverHeader>
              <PopoverTitle>Programmatic</PopoverTitle>
              <PopoverDescription
                >Controlled via external buttons.</PopoverDescription
              >
            </PopoverHeader>
          </PopoverContent>
        </Popover>
        <div class="flex gap-2">
          <button
            id="popover-open-btn"
            class="px-3 py-1.5 text-sm border rounded-lg hover:bg-muted"
          >
            Open
          </button>
          <button
            id="popover-close-btn"
            class="px-3 py-1.5 text-sm border rounded-lg hover:bg-muted"
          >
            Close
          </button>
        </div>
      </div>
      <script>
        const programmaticPopover = document.getElementById(
          "programmatic-popover",
        );

        document
          .getElementById("popover-open-btn")
          ?.addEventListener("click", () => {
            programmaticPopover?.dispatchEvent(
              new CustomEvent("popover:set", { detail: { open: true } }),
            );
          });

        document
          .getElementById("popover-close-btn")
          ?.addEventListener("click", () => {
            programmaticPopover?.dispatchEvent(
              new CustomEvent("popover:set", { detail: { open: false } }),
            );
          });
      </script>
    </KitchenSinkSection>
  </section>
</KitchenSinkLayout>
